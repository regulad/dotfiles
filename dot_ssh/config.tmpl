# Configuration
AddKeysToAgent yes
HashKnownHosts yes

# "Special" hosts
Host neodingus
    HostName neodingus.tail11540.ts.net
    User root
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/id_rsa.pub
    IdentityFile ~/.ssh/id_rsa  # fallback
{{- end }}
    IdentitiesOnly yes
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host prodingus
    HostName prodingus.tail11540.ts.net
    User root
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/id_rsa.pub
    IdentityFile ~/.ssh/id_rsa  # fallback
{{- end }}
    IdentitiesOnly yes
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host samsung-sm-a526u1
    HostName samsung-sm-a526u1.tail11540.ts.net
    Port 8022
    User u0_a322
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/id_rsa.pub
    IdentityFile ~/.ssh/id_rsa  # fallback
{{- end }}
    IdentitiesOnly yes
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host pihole
    HostName pihole.home.arpa
    User root
    PubkeyAuthentication no
    PreferredAuthentications password

# Static hosts
Host macserver
    HostName macserver.tail11540.ts.net

Host winserver
    HostName winserver.tail11540.ts.net

Host dingus-server
    HostName dingus-server.tail11540.ts.net
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host pelican
    HostName pelican.tail11540.ts.net
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host matrix
    HostName matrix.tail11540.ts.net
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host tinker
    HostName tinker.tail11540.ts.net
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host lancache
    HostName lancache.home.arpa
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host proencode
    HostName proencode.home.arpa
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host procuda
    HostName procuda.home.arpa
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host freeipa
    HostName freeipa.home.arpa
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host timemachine
    HostName timemachine.home.arpa
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host gha
    HostName gha.home.arpa
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host microk8s
    HostName microk8s.home.arpa
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

# Mobile hosts
Host penumbra
    HostName penumbra.tail11540.ts.net
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

# Windows hosts
Host winlite
    User regulad
    HostName winlite.tail11540.ts.net

# Oracle (Legacy VCN)
Host git.regulad.xyz

Match Host git.regulad.xyz User opc
    User opc
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/id_rsa.pub
    IdentityFile ~/.ssh/id_rsa  # fallback
{{- end }}
    IdentitiesOnly yes
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host doppelgangerhq.com
    User ubuntu
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/id_rsa.pub
    IdentityFile ~/.ssh/id_rsa  # fallback
{{- end }}
    IdentitiesOnly yes
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

# Oracle (wahlecloud)
Host tailscalerouter

Match Host tailscalerouter User opc
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/ssh-key-2025-12-08_tailscalerouter.key.pub
    IdentityFile ~/.ssh/ssh-key-2025-12-08_tailscalerouter.key  # fallback
{{- end }}
    IdentitiesOnly yes
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host livekit

Match Host livekit User opc
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/ssh-key-2025-12-19_livekit.key.pub
    IdentityFile ~/.ssh/ssh-key-2025-12-19_livekit.key  # fallback
{{- end }}
    IdentitiesOnly yes
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host mail
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Match Host mail User opc
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/ssh-key-2025-12-08_mail.key.pub
    IdentityFile ~/.ssh/ssh-key-2025-12-08_mail.key  # fallback
{{- end }}
    IdentitiesOnly yes

# Personal
Host github.com
    HostName github.com
    User git
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/id_rsa.pub
    IdentityFile ~/.ssh/id_rsa  # fallback
{{- end }}
    IdentitiesOnly yes

Host git.regulad.xyz
    HostName git.regulad.xyz
    User git
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/id_rsa.pub
    IdentityFile ~/.ssh/id_rsa  # fallback
{{- end }}
    IdentitiesOnly yes

Host invent.kde.org
    HostName invent.kde.org
    User git
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/id_rsa.pub
    IdentityFile ~/.ssh/id_rsa  # fallback
{{- end }}
    IdentitiesOnly yes

# ncsu
Host github.ncsu.edu
    HostName github.ncsu.edu
    User git
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/id_ed25519_ncstate.pub
    IdentityFile ~/.ssh/id_ed25519_ncstate  # fallback
{{- end }}
    IdentitiesOnly yes

## rotating host keys and password only authentication.
## excellent security, mr. bond
Host eos
    # lab server
    HostName remote.eos.ncsu.edu
    User pewahle    
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null
    PubkeyAuthentication no
    PreferredAuthentications password
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host grendel
    # x86_64
    ForwardX11 yes
    HostName grendel.ece.ncsu.edu
    User pewahle
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null
    PubkeyAuthentication no
    PreferredAuthentications password
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host hydra
    # GPU
    ForwardX11 yes
    HostName hydra.ece.ncsu.edu
    User pewahle
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null
    PubkeyAuthentication no
    PreferredAuthentications password
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

Host kraken
    # arm
    ForwardX11 yes
    HostName kraken.ece.ncsu.edu
    User pewahle
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null
    PubkeyAuthentication no
    PreferredAuthentications password
    RequestTTY yes
    RemoteCommand bash -c 'if command -v tmux >/dev/null 2>&1; then exec tmux new-session -A -s ssh_tmux; else echo "warning: tmux not available, falling back to login shell" >&2; exec $SHELL -l; fi'

# Globals
Host *
    # Try to use the user regulad on all systems
    User regulad
    PreferredAuthentications publickey   

# General idea of the fallback:
#    1. Try to get the agent's private key by the public key
#    2. If the private key isn't in the agent, and it exists on disk, load it. Else, crash.
Match User regulad
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/id_rsa.pub
    IdentityFile ~/.ssh/id_rsa  # fallback
{{- end }}
    IdentitiesOnly yes

Match User pewahle  # ncsu
{{- if not .useDummySecrets }}
    IdentityFile ~/.ssh/id_ed25519_ncstate.pub
    IdentityFile ~/.ssh/id_ed25519_ncstate  # fallback
{{- end }}
    IdentitiesOnly yes

